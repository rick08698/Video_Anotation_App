# 公園動画アノテーション作業ガイド

この文書は、公園の監視動画を用いて**5分区切り**で「人数」と「行動内訳（移動／滞留）」を一貫して付与するための手順をまとめたものです。短時間での判断ブレを減らし、誰が作業しても同じ結果になりやすいことを目指します。

---

## 1. 目的とアウトプット
- **目的**: 5分ウィンドウごとに、その区間に**写ったユニーク人数**を数え、行動を「移動／滞留」に分類する。
- **最終アウトプット（推奨CSV）**: 1行＝5分ウィンドウ。
  - `video_id, window_start, window_end, total_unique, moving_count, staying_count, notes`

> ここでの「人数」は、その5分間に**一度でも**画面内に写った**ユニーク人物数**です（同一人物が何度も出入りしても **1人** と数える）。

---

## 2. 対象データ
- **対象**: 公園の固定カメラ動画（音声は不要）。
- **前提**: 動画は連続しており、タイムスタンプ（再生時間）が把握できる状態。
- **ファイル命名規則**: `PYYMMDD_HHMMSS_HHMMSS.mp4`（または `PYYMMDD-HHMMSS-HHMMSS.mp4`）を用いる（YYは2000年代の2桁年。例: 25→2025）。  
  - **例**：2025年9月1日 12:00:00〜12:29:59 の動画 → `P250901_120000_122959.mp4`

---

## 3. 基本単位（5分ウィンドウ）
- 例: 00:00–05:00, 05:00–10:00, 10:00–15:00, … のように **[開始, 終了)** の半開区間で区切る。
- 各ウィンドウで、以下を記録：
  - そのウィンドウに一度でも写った**ユニーク人数**（`total_unique`）
  - 行動内訳：
    - **移動（moving）**：その5分のうち**累計可視時間 < 120秒**（≒通過）
    - **滞留（staying）**：その5分のうち**累計可視時間 ≥ 120秒**（2分以上）

> **重要**：滞留判定は**各5分ウィンドウ内の累計可視時間で判定**します（前後のウィンドウは考えず、そのウィンドウだけで≥120秒かどうか）。

---

## 4. 用語と判定基準
### 4.1 人数（`total_unique`）
- 同一人物を識別して**重複カウントしない**。服装・持ち物・体格・同行者関係・出入り位置などで識別。
- 5分内に一瞬でも写れば **1人** として数える（ただし行動分類は滞留/移動の基準で別途判定）。

### 4.2 行動内訳
- **滞留（staying）**：5分内の**累計可視時間 ≥ 120秒**。
  - 座る、立ち話、遊具で遊ぶ、ベンチ/芝生で長めに過ごす等。
- **移動（moving）**：5分内の**累計可視時間 < 120秒**かつ主に**通過**のニュアンス。
  - 園路を横切るだけ、通り抜け、短時間の立ち止まりのみ。

> **ニュアンス**：依頼意図として、**移動＝通りすぎただけ**、**滞留＝公園を利用している** と理解してください。

### 4.3 可視時間の数え方
- 同一人物が出入りを繰り返す場合は、**その5分内での合計可視時間**を積算して判定。
- 画面端で一瞬映るだけ → 移動。
- 途中で遮蔽物や他者と重なり一時的に見えなくなっても、連続行動と判断できる範囲は継続扱い。

---

## 5. 具体的な作業手順
1. **準備**
   - 動画を再生（任意のプレイヤーでOK。再生時間が見えるもの）。
   - 5分ごとの**ウィンドウ境界**をメモ（例：00:00, 05:00, 10:00, …）。
2. **人物トラッキング（目視）**
   - ウィンドウ開始時刻から終了時刻まで、**人物ごと**に「画面に写っている時間」を大まかに計測。
   - 簡易でよい：秒単位の厳密さは不要。**±5–10秒程度**の誤差は許容。
3. **分類**
   - 各人物の可視時間合計が **120秒以上** → **滞留**
   - **120秒未満** → **移動**
4. **集計**
   - そのウィンドウに写った**ユニーク人数**を `total_unique` に記入。
   - **移動人数**と**滞留人数**をカウントし、`moving_count` / `staying_count` に記入。
5. **メモ（任意）**
   - 異常天候、イベント、工事、見えにくさ（逆光・雨滴・夜間）など、判断に影響する事情は `notes` に記録。

---

## 6. 出力フォーマット（CSV想定）
```csv
date,window_start,window_end,total_unique,moving_count,staying_count,notes
2025-09-11,00:00,05:00,12,9,3,"雨で視界やや悪い"
2025-09-11,05:00,10:00,15,10,5,"ベンチ2組が滞留"
```
- `date` はP形式（実時間）で作業した場合に付与（`YYYY-MM-DD`）。相対時間のみの場合は空欄。
- `window_start` / `window_end` は `MM:SS` か `HH:MM:SS` で統一。
- 1本の長尺動画を `video_id` で識別（`YYYY-MM-DD_camID` など、任意の一貫した命名）。

> もし**人物別の詳細ログ**も残せる場合は、以下のような補助CSVを推奨：
```csv
date,window_start,person_local_id,visible_sec,behavior,remarks
2025-09-11,00:00,p001,145,moving,"園路通過"
2025-09-11,00:00,p002,230,staying,"ベンチ座り"
```
- `person_local_id` は**そのウィンドウ内だけで一意**ならOK（p001, p002, …）。

---

## 7. 境界ケースの扱い（迷ったらここ）
- **ウィンドウまたぎ**：判定は**各ウィンドウ単位**。前後は参照せず、そのウィンドウ内で ≥120秒なら滞留。
- **複数人のグループ**：各人を別々にカウント。子どもも1人として数える。
- **ベビーカー・自転車**：**人**を数える（乗り物は人数に含めない）。明らかに通過目的なら移動。
- **画面外での滞在不明**：画面内で見える時間のみで判定（推測しない）。
- **部分遮蔽・一時見失い**：連続移動とみなせる範囲は可視時間として連結。
- **作業密度**：厳密なストップウォッチ計測は不要。**明確な2分以上かどうか** を中心にしきい値判断。

---

## 8. 品質管理（任意だが推奨）
- **二重アノテーション**：全体の10%程度を別注釈者で重複付与し、差分を確認（人数±1–2人、滞留の一致率）。
- **スポットレビュー**：滞留が多すぎる／少なすぎるウィンドウを抽出し、再確認。
- **ルール更新**：迷い事例を `notes` に蓄積し、定期的にガイド更新。

---

## 9. 作業のコツ
- **固定視点**で追う：画面端から端へ移動する人物を目で追い、**可視時間合計**を意識。
- **滞留のサイン**：立ち止まり、座る、遊具の反復、会話の停滞など。
- **移動のサイン**：視野に入って→抜けるまでが短い、止まっても数十秒程度。

---

## 10. 付録：最小テンプレート（Markdown）
```md
# Annotation Sheet (per 5 min)
- video_id:
- window: [start] – [end]
- total_unique: 
- moving_count:
- staying_count:
- notes:
```

---

### 最終チェックリスト
- [ ] 5分境界でウィンドウを切った
- [ ] 各ウィンドウで**ユニーク人数**を数えた
- [ ] 各人物の**可視時間合計**で「滞留（≥120s）/移動（<120s）」を判定
- [ ] `moving_count + staying_count == total_unique`
- [ ] 迷った点・特記事項を `notes` に記録
